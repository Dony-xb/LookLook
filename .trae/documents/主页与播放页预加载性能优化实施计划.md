## 总览
- 主页：使用 Paging3 + 视图与资源预加载（Coil）+ 列表末端触发加载；形成“无限下滑”架构，即使当前数据量较小也可演示完整方法。
- 播放页：下一条视频媒体数据预取（缓存首段字节 + ExoPlayer 队列）+ 首帧就绪判断优化封面显示逻辑（预加载命中则不再显示封面）。

## 主页优化
- 数据层：新增 `VideoPagingSource`（或 `Pager`），一次性拿到 `Videos.json` 后切分为分页（例如 `pageSize=10`），随滚动加载下一页。
- 视图层：
  - `HomeViewModel` 暴露 `Pager` 的 `Flow<PagingData<Video>>`
  - `HomeScreen` 使用 `collectAsLazyPagingItems()` 与 `LazyVerticalGrid` 的 `items(count, key)` 渲染；保持唯一 key（`id+index`）
  - 预加载封面：通过 `LazyGridState` 监听可见项，提前 N 项（如 4-8）用 Coil 进行图片预取（`imageLoader.enqueue(ImageRequest)`）；避免下滑时图片卡顿
  - 列表末端加载：当可见项接近末尾（如剩余 < 6 项）时触发下一页加载

## 播放页优化
- 预取策略：
  - 继续使用已经实现的缓存预取（CacheDataSource 读取下一条视频前 512KB）并记录“已预取 URL”的集合
  - 设置队列：`setMediaItems(current,next)`，ExoPlayer 自动为下一条进行少量预缓冲
- 封面显示逻辑优化：
  - 添加 `isPrefetched(url)` 判断；当进入某页且该 URL 已预取，则不显示封面（即使未收到 `STATE_READY`，也跳过覆盖层），避免首帧与封面之间的过渡不平滑
  - 其他情况保留封面（未预取或首次播放）以避免黑屏

## 涉及文件（将会修改/新增）
- `app/src/main/java/com/looklook/feature/home/ui/HomeScreen.kt`（改为 Paging 列表、键与预取逻辑）
- `app/src/main/java/com/looklook/feature/home/ui/HomeViewModel.kt`（新增 Pager 暴露）
- `app/src/main/java/com/looklook/core/repository/VideoPagingSource.kt`（新增，分页切片）
- `app/src/main/java/com/looklook/feature/video/ui/PlayerViewModel.kt`（新增 `prefetchRegistry` 与 `isPrefetched(url)`）
- `app/src/main/java/com/looklook/feature/video/ui/VideoFeedScreen.kt`（封面显示逻辑改为命中预取则跳过）

## 方法总结（将提供代码片段）
- Paging3 核心：`Pager(config=PagingConfig(pageSize=...)) { VideoPagingSource(...) }` → `collectAsLazyPagingItems()`
- 末端加载信号：通过 `LazyPagingItems.loadState.append` 或通过 `LazyGridState.layoutInfo.lastVisibleItemIndex` 来触发 `pagingItems.retry()`/`pagingItems.refresh()` 或自动追加加载
- 图片预取：`val req = ImageRequest.Builder(ctx).data(url).build(); imageLoader.enqueue(req)`；结合 `snapshotFlow { gridState.layoutInfo.visibleItemsInfo }` 计算预取范围
- 视频预取与封面逻辑：
  - `PlayerViewModel.prefetch(url)` → CacheDataSource 读取前 512KB → `prefetchedUrls.add(url)`
  - `val showCover = page != current || (!ready && !isPrefetched(item.streamUrl))`

## 验证
- assembleDebug 通过
- 主页：快速滚动时图片稳定、到末尾自动加载下一页（演示模式）
- 播放页：切到下一条时若命中预取，不显示封面直接播放，首帧更平滑

## 文档更新
- README 与 DevelopmentProcess 增加“主页与播放页预加载方案”条目、涉及文件与关键方法、代码示例与复盘说明